第二十章

![image](img/frontdot.jpg)

运算符重载

运算符重载允许在一个或两个操作数属于用户定义的类时重新定义和使用运算符。如果操作正确，这可以简化代码，并使用户定义的类型像基本类型一样易于使用。

运算符重载示例

在下面的例子中，有一个名为`MyNum`的类，它有一个整数字段和一个用于设置该字段的构造函数。该类还有一个加法方法，将两个`MyNum`对象相加，并将结果作为一个新对象返回。

```cpp
class MyNum
{
 public:
  int val;
  MyNum(int i) : val(i) {}

  MyNum add(MyNum &a)
  { return MyNum( val + a.val ); }
}
```

使用这种方法可以将两个`MyNum`实例添加在一起。

```cpp
MyNum a = MyNum(10), b = MyNum(5);
MyNum c = a.add(b);
```

二进制运算符重载

运算符重载的作用是简化语法，从而为类提供更直观的接口。要将`add`方法转换为加法符号的重载，请将方法名替换为`operator`关键字，后跟要重载的运算符。关键字和操作符之间的空格可以选择省略。

```cpp
MyNum operator + (MyNum &a)
{ return MyNum( val + a.val ); }
```

由于该类现在重载了加法符号，因此该运算符可用于执行所需的计算。

```cpp
MyNum c = a + b;
```

请记住，运算符只是调用实际方法的替代语法。

```cpp
MyNum d = a.operator + (b);
```

一元运算符重载

加法是二元运算符，因为它需要两个操作数。第一个操作数是调用该方法的对象，第二个操作数是传递给该方法的对象。当重载一元操作符时，比如前缀增量(`++`)，不需要方法参数，因为这些操作符只影响调用它们的对象。

对于一元运算符，应该总是返回与对象类型相同的引用。这是因为当对一个对象使用一元运算符时，程序员希望结果返回同一个对象，而不仅仅是一个副本。另一方面，当使用二元运算符时，程序员希望返回结果的副本，因此应该使用按值返回。

```cpp
MyNum& operator++() // ++ prefix
{ ++val; return *this; }
```

并非所有一元运算符都应通过引用返回。两个后缀操作符——后递增和后递减——应该改为按值返回，因为后缀操作应该在递增或递减发生之前返回对象的状态。请注意，后缀运算符指定了一个未使用的`int`参数。此参数用于将它们与前缀运算符区分开来。

```cpp
MyNum operator++(int) // postfix ++
{
  MyNum t = MyNum(val);
  ++val;
  return t;
}
```

过载运算符

C++ 允许重载语言中几乎所有的操作符。从下表中可以看出，大多数运算符都是二进制类型的。其中只有少数是一元的，有些特殊运算符不能归为这两种。还有一些运算符根本不能重载。

| 

二元运算符

 | 

一元运算符

 |
| --- | --- |
| + - * / % | + - !~ & * ++ - |
| = + = - = * = / = % = | **特殊操作员** |
| & = ^ = &#124; = << = > > = | ()[ ]删除新的 |
| == != > < > = < = | **不可过载** |
| & &#124; ^ << > > && &#124;&#124; | <sup>。。*::？□sizo〔t1〕</sup> |
| –> – >* , |   |