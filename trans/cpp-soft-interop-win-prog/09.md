# 9.结论

在本书中，我们的目标是开发将 C++ 代码库(虽然简单，但有点做作)连接到用其他语言编写的客户端软件的组件，特别是 C#、R 和 Python。目的是使 C++ 库中的功能可用，并允许从其他客户端语言访问该功能。这是我们已经完成的。在这样做的时候，我们已经涉及了相当多的领域。

我们从构建一个 C++ 统计函数库开始。这构成了我们想要向客户展示的基础。原因是这很容易理解，但比一个玩具例子更完整。在开发连接到其他语言的包装器组件时，它有足够的特性来说明现实世界中的问题。在整本书中，我们让源代码驱动我们想要公开的内容，虽然这在某种程度上限制了覆盖范围，但也更易于管理。

在这个 C++ 代码基础之上，我们构建了包装器组件，允许我们向不同的语言公开 C++ 功能。首先，我们构建了一个 C++/CLI 程序集。我们看到它在许多不同的环境中是多么容易使用。我们在一个简单的控制台客户端中测试了该功能——测试了我们调用的函数以及该组件如何与其他 C# 库(在本例中为 Accord)进行互操作。网)。我们还通过 Excel-DNA 毫不费力地将组件连接到 Excel。

在此之后，我们构建了一个 R 包，它使用 Rcpp 将 C++ 代码库连接到 R。和以前一样，我们练习了基本功能，但也看了一下如何将 StatsR 组件与其他 R 包一起使用，特别是`tidyverse`、`ggplot,`和`benchmark`。最后，我们构建了一个闪亮的小应用程序来演示我们的组件如何与其他 R 包交互。我们看到了 StatsR 包可以在广阔的 R 宇宙中的任何地方使用。在这个过程中，我们建立了一个开发基础设施，它由一个 IDE (CodeBlocks)和一个 IDE 组成，IDE 用于使用 R 所需的编译器来构建 C++ 代码，IDE 用于编写 Rcpp 包(RStudio)，我们可以使用它来开发和构建包。

最后，我们还构建了 Python 扩展模块:确切地说是三个。我们看到了使用低级 CPython 方法的潜在缺陷，然后考虑使用两种 Boost。Python 和 PyBind 作为连接 C++ 和 Python 的框架。我们看到了这两种框架如何促进包装组件的开发。我们还看到，潜在的性能提升(不能保证)只是将 C++ 连接到 Python 的众多可能原因之一。将一个新的组件引入 Python 世界，与 NumPy 和 Pandas 等库一起无缝运行，这也是非常重要的。

总的来说，我们已经了解了如何为不同的语言包装组件建立项目。我们已经花了一些时间来研究包装器的设计:将关注点分成功能层、进行调用的部分和类型转换层。我们已经研究了类型转换的细节，以及如何有效地推广它们。在这个过程中，我们触及了许多其他的软件开发主题:一些与代码相关的，比如异常处理；其他的与开发过程相关，比如测试和调试。除了简单地构建组件，我们还建立了一个简化(多语言)开发过程的工具基础设施。

另一方面，在限制我们自己公开有限的 C++ 库中的底层功能时，我们忽略了许多重要的方面。我们还没有触及原生 C++ 库中的线程和并发性，以及如何将其暴露给不同的客户端语言。从实际组件的角度来看，我们忽略了许多方面。在 C# 中，我们还没有覆盖委托；在 R 中，我们没有涉及扩展模块；在 Python 中，我们仅仅触及了 PyBind 的皮毛。所有这些都需要一本书。我们在这里提供的是未来发展的一些起点。

在更一般的层面上，目的是扩展开发软件时可用的架构选择。在第 [2](02.html) 章中，我们看到了在 Windows 应用程序中直接包含组件的一些限制(链接到组件*库*或 *dll* )。我们已经证明了一个可行的替代方案是开发可以在多种上下文(Windows 应用程序、web 应用程序)中使用的包装器组件(程序集、包和模块),并且来自不同的语言，C#、R 和 Python。这导致了一个更加松散耦合的软件系统。组件本身可以提供完全异构的服务，但是它们可以互操作，因为它们参与了底层框架，无论它是。NET 通过 C++/CLI，R 通过 Rcpp，或者 Python。